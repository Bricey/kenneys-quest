var RPG=RPG||{};RPG.enemyType={},RPG.enemyType.goblin={attack:2,defence:1,speed:70,bounds:[10,0,40,60]},RPG.enemyType.orc={attack:2,defence:2,speed:50,bounds:[20,10,40,70]},RPG.enemyType.dark_kenney={attack:2,defence:2,speed:50,bounds:[10,10,50,40]},RPG.Enemy=function(t,a,i,e){Phaser.Sprite.call(this,t.game,a,i,e.name),this.state=t,this.game=t.game,this.data=e,this.anchor.setTo(.5),this.collideWorldBounds=!0,this.direction=1,this.isMoving=!1,this.isAttacking=!1,this.isAttacked=!1,this.movePause=!1,this.targetX=0,this.targetY=0,this.patrolEngaged=!0,this.combatEngaged=!1,this.alertEngaged=!1,this.targetDistance=70,this.hitSound="enemy_hit",this.alertRange=60*this.data.alertRange,this.isHit=!1,this.isDead=!1,this.data.isShooter&&(this.shootingTimer=this.game.time.create(!1));var s=8;if(this.animations.add("walkFwd",[0,1,0,2],s,!0),this.animations.add("walkBwd",[3,4,3,5],s,!0),"goblin"===this.data.key)this.data.attack=RPG.enemyType.goblin.attack,this.data.defence=RPG.enemyType.goblin.defence,this.data.speed=RPG.enemyType.goblin.speed,this.health=Rnd.integer(2,4),this.animations.add("walkLft",[6,7,6,8],s,!0),this.animations.add("walkRgt",[9,10,9,11],s,!0),this.animations.add("attackLft",[21,22,23],5,!1),this.animations.add("attackRgt",[18,19,20],5,!1),this.animations.add("attackFwd",[12,13,14],5,!1),this.animations.add("attackBwd",[15,16,17],5,!1),this.animations.add("death",[31,32,33],4,!1),this.data.isShooter&&(this.animations.add("swingFwd",[24,25],4,!0),this.animations.add("swingBwd",[27,28],4,!0),this.animations.add("swingSide",[29,30],4,!0),this.animations.add("throwFwd",[26],1,!0),this.animations.add("throwBwd",[29],1,!0),this.animations.add("throwSide",[32],1,!0));else if("orc"===this.data.key)this.data.attack=RPG.enemyType.orc.attack,this.data.defence=RPG.enemyType.orc.defence,this.data.speed=RPG.enemyType.orc.speed,this.health=Rnd.integer(4,7),this.targetDistance=90,this.animations.add("walkLft",[6,7,6,8],s,!0),this.animations.add("walkRgt",[13,14,13,15],s,!0),this.animations.add("attack",[9,10,11,12],10,!0),this.animations.add("death",[16,17,18],4,!1);else if("dark_kenney"===this.data.key)this.animations.add("walkLft",[17,18,17,19],s,!0),this.animations.add("walkRgt",[20,21,20,22],s,!0),this.animations.add("walkFwd",[11,12,11,13],s,!0),this.animations.add("walkBwd",[23,24,23,25],s,!0),this.animations.add("attackRgt",[29,30,31],24,!1),this.animations.add("attackLft",[32,33,34],24,!1),this.animations.add("attackFwd",[14,15,16],24,!1),this.animations.add("attackBwd",[26,27,28],24,!1),this.animations.add("death",[10],s,!1),this.data.attack=RPG.enemyType.dark_kenney.attack,this.health=Rnd.integer(3,6);else if("crystal"===this.data.key){this.animations.add("create",[8,9,10,11],6,!1),this.animations.add("death",[3,4,5,6,7],10,!1),this.hitSound="break";var n=this;this.deathTimer=setTimeout(function(){var t=n.animations.play("death");t.onComplete.add(function(){n.kill()},n)},1800)}this.game.physics.arcade.enable(this),this.enableBody=!0,this.body.collideWorldBounds=!0,this.body.immovable=!0,this.inputEnabled=!0,this.input.useHandCursor=!0,this.body.onCollide=new Phaser.Signal,this.events.onInputDown.add(this.playerAttack,this)},RPG.Enemy.prototype=Object.create(Phaser.Sprite.prototype),RPG.Enemy.prototype.constructor=RPG.Enemy,RPG.Enemy.prototype.update=function(){if(!this.isHit)return"orc"===this.data.key&&this.isAttacking?(this.body.velocity.setTo(0),void(RPG.game.physics.arcade.distanceBetween(this,Player)<=this.targetDistance&&RPG.GameState.playerHit(this.data.attack,this.faceDirection(Player.world.x,Player.world.y,!0)))):this.data.isShooter&&RPG.game.physics.arcade.distanceBetween(this,Player)>this.alertRange?(this.isAttacking=!1,this.isAlerted=!1,void this.shootingTimer.stop()):this.data.isShooter&&this.isAttacking?(this.targetX=Player.world.x,void(this.targetY=Player.world.y)):void(RPG.game.physics.arcade.distanceBetween(this,Player)<=this.alertRange?this.data.hasDialogue?(RPG.GameState.initDialogue(this.data,!!this.data.hasPortrait,!0),this.data.hasDialogue=!1):this.isAttacking||(this.isMoving=!1,this.isAlerted=!0,this.data.isShooter?this.engageShooting():this.engageCombat()):this.isAlerted&&!this.data.isShooter&&this.engageCombat())},RPG.Enemy.prototype.attack=function(){this.isHit=!1,this.isAttacking=!0,this.isAlerted=!1;var t;if("goblin"===this.data.key||"dark_kenney"===this.data.key)t=this.animations.play("attackFwd"),t.onComplete.add(this.attackEnd,this);else if("orc"===this.data.key){t=this.animations.play("attack"),t.onLoop.add(function(){RPG.game.sound.play("orc_attack")},this);var a=this;setTimeout(function(){a.animations.stop(),this.isStationary=!1,a.frame=0,a.isAttacking=!1,a.isHit=!0,setTimeout(function(){a.isHit=!1,a.isMoving=!0},Rnd(1e3,2400))},Rnd(2e3,4e3))}},RPG.Enemy.prototype.attackEnd=function(){var t=this;RPG.game.physics.arcade.distanceBetween(Player,this)<=66&&RPG.GameState.playerHit(this.data.attack,this.faceDirection(Player.world.x,Player.world.y,!0)),setTimeout(function(){t.isAttacking=!1,t.isAlerted=!0},1500)},RPG.Enemy.prototype.faceDirection=function(t,a,i){var e=t,s=a,n=RPG.game.physics.arcade.angleToXY(this,e,s);if(this.scale.setTo(1),n>-.785&&n<.785){if(i)return"left";this.data.isShooter?this.animations.play("swingSide"):this.animations.play("walkLft")}else if(n>.785&&n<2.356){if(i)return"top";this.data.isShooter?this.animations.play("swingFwd"):this.animations.play("walkFwd")}else if(n>2.356||n<-2.356){if(i)return"right";this.data.isShooter?(this.animations.play("swingSide"),this.scale.setTo(-1,1)):this.animations.play("walkRgt")}else if(n<-.785&&n>-2.356){if(i)return"bottom";this.data.isShooter?this.animations.play("swingBwd"):this.animations.play("walkBwd")}},RPG.Enemy.prototype.engageCombat=function(){if(this.targetX=Player.world.x,this.targetY=Player.world.y,this.faceDirection(this.targetX,this.targetY),RPG.game.physics.arcade.moveToObject(this,Player,this.data.speed),RPG.game.physics.arcade.distanceBetween(this,Player)<=this.targetDistance)if(this.body.velocity.setTo(0),"goblin"===this.data.key||"dark_kenney"===this.data.key)this.attack();else if("orc"===this.data.key){this.isHit=!0,this.frame=0;var t=this;setTimeout(function(){this.isHit=!1,t.attack()},Rnd(300,600))}},RPG.Enemy.prototype.engageShooting=function(){this.isAttacking=!0,this.animations.play("swingFwd"),this.shootingTimer.start(),this.scheduleShooting()},RPG.Enemy.prototype.scheduleShooting=function(){this.faceDirection(this.targetX,this.targetY),this.createEnemyProjectile(),this.shootingTimer.add(Phaser.Timer.SECOND/.4,this.scheduleShooting,this)},RPG.Enemy.prototype.createEnemyProjectile=function(){var t=RPG.GameState.enemyProjectiles.getFirstExists(!1);if(t)t.reset(this.centerX,this.centerY);else{var t=new RPG.Projectile(RPG.GameState,this.x,this.y,"bullet");RPG.GameState.enemyProjectiles.add(t)}t.origin=this,RPG.game.sound.play("projectile"),RPG.game.physics.arcade.moveToXY(t,this.targetX,this.targetY,t.data.speed)},RPG.Enemy.prototype.playerAttack=function(){RPG.GameState.faceDirection(Player,this.x,this.y),Player.attackTarget=this};