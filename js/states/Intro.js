var RPG=RPG||{};RPG.IntroState={create:function(){this.music=this.game.add.audio("music_intro",.6,!1).play(),this.game.stage.backgroundColor="#000",this.cutSceneFired=!1,this.textGroup=this.game.add.group(),this.background=this.add.sprite(0,30,"mountain"),this.background.alpha=0,this.wall=this.add.tileSprite(0,0,this.game.world.width,this.game.height/5.2,"intro_wall"),this.wall.alpha=0,this.fire1=this.add.sprite(this.game.width/4,this.game.height/2.5,"fire"),this.fire1.animations.add("play"),this.fire1.animations.play("play",2,!0),this.fire2=this.add.sprite(this.game.width/1.35,this.game.height/2.5,"fire"),this.fire2.animations.add("play"),this.fire2.animations.play("play",2,!0),this.fire1.anchor.setTo(.5),this.fire2.anchor.setTo(.5),this.fire1.alpha=0,this.fire2.alpha=0,this.sword=this.game.add.sprite(this.game.world.centerX,this.game.height/2+20,"sword"),this.sword.alpha=0,this.harperSprite=this.game.add.sprite(this.game.world.centerX,this.game.height/2.5,"npc_stephen_harper"),this.harperSprite.alpha=0,Player=this.game.add.sprite(this.game.world.centerX,this.game.height+30,"player"),Player.alpha=0;var t=this,e=["Alberta cries out.","Only I can hear its suffering.","Albertans, divided, are too weak to stand against a pro-tax, job-killing government.","My destiny is clear..."];this.i=setTimeout(function(){t.setText(e[0]),this.i=setTimeout(function(){t.setText(e[1],t.game.height/4+60),this.i=setTimeout(function(){t.clearText(),this.i=setTimeout(function(){t.setText(e[2]),this.i=setTimeout(function(){t.clearText(),this.i=setTimeout(function(){t.setText(e[3]),this.i=setTimeout(function(){t.clearText(1e3),this.i=setTimeout(function(){t.introCutScene()},1200)},3e3)},1e3)},3e3)},1200)},2e3)},1600)},2e3),this.nextBtn=new RPG.NextBtn(this,this.game.width-240,this.game.height-60),this.add.existing(this.nextBtn),this.skipText=this.add.text(this.game.width-180,this.game.height-80,"Skip Intro",RPG.textStyle),this.nextBtn.events.onInputDown.add(this.menuSetup,this)},introCutScene:function(){this.cutSceneFired||(this.game.camera.flash(0,2e3),this.wall.alpha=1,this.fire1.alpha=1,this.fire2.alpha=2,this.harperSprite=this.game.add.sprite(this.game.world.centerX,this.game.height/2.5,"npc_stephen_harper"),this.harperSprite.anchor.setTo(.5),this.harperSprite.frame=0,this.harperSprite.alpha=1,Player.anchor.setTo(.5),Player.frame=6,Player.animations.add("walkBwd",[6,7,6,8],8,!0),Player.alpha=1,this.tween=this.game.add.tween(Player).to({y:this.game.height/1.5},2e3,null).start(),Player.animations.play("walkBwd"),this.tween.onComplete.add(function(){var t=["Kenney: Master Harper! I've had a premonition.","Kenney: I must return at once to Alberta to unite our people.","Harper: It has been known for some time. I, too, must leave Ottawa.","Harper: I have donned the robes of a wise man and will be ascending into the realm of consultancy work.","Harper: Before you leave for Alberta, Jason...","Harper: ...it's dangerous to go alone. Take this."],e=this;Player.animations.stop(),this.i=setTimeout(function(){e.setText(t[0],null,!0),this.i=setTimeout(function(){e.clearText(),this.i=setTimeout(function(){e.setText(t[1],null,!0),this.i=setTimeout(function(){e.clearText(),this.i=setTimeout(function(){e.setText(t[2],null,!0),this.i=setTimeout(function(){e.clearText(),this.i=setTimeout(function(){e.setText(t[3],null,!0),this.i=setTimeout(function(){e.clearText(),this.i=setTimeout(function(){e.setText(t[4],null,!0),this.i=setTimeout(function(){e.clearText(),this.i=setTimeout(function(){e.setText(t[5],null,!0),this.i=setTimeout(function(){e.setSword()},3600)},1e3)},3200)},1e3)},3e3)},1e3)},3e3)},1e3)},3200)},1e3)},3200)},200)},this))},endScene:function(){this.state.start("Game")},menuSetup:function(){this.music.stop(),this.music=this.game.add.audio("music_mainTheme",.6,!0).play(),clearTimeout(this.i),clearTimeout(this.j),this.cutSceneFired=!0,this.harperSprite.destroy(),this.sword.destroy(),this.fire1.destroy(),this.fire2.destroy(),this.textGroup.destroy(),this.nextBtn.destroy(),this.game.camera.flash(16777215,500),this.background.alpha=1,this.kq_logo=this.game.add.sprite(this.game.world.centerX,130,"kq_logo"),this.kq_logo.anchor.setTo(.5),this.kq_logo.scale.setTo(.5),this.kq_logo.x=this.game.world.centerX,this.kq_logo.y=130,this.kq_logo.alpha=1,this.epText=this.add.text(this.game.world.centerX+68,190,"Episode 1",{font:"Helvetica,Arial,sans-serif",fontSize:18,fill:"#cccdcd"}),this.wall.loadTexture("intro_ground"),this.wall.alpha=1,this.wall.y=this.game.height-this.wall.height,this.wall.autoScroll(-60,0),Player.loadTexture("intro_truck"),Player.animations.add("drive",[0,1],8,!0),Player.animations.play("drive"),Player.alpha=1,Player.anchor.setTo(.5),Player.y=this.game.height/1.25,this.skipText.setText("New Game"),this.skipText.x=this.game.world.centerX,this.skipText.y=this.game.world.centerY-20,this.skipText.anchor.setTo(.5),this.skipText.setShadow(0,0,"rgba(0,0,0,0.8)",10),this.skipText.inputEnabled=!0,this.skipText.input.useHandCursor=!0,this.skipText.events.onInputDown.add(this.newGame,this),null!==localStorage.getItem("data")&&(this.continueText=this.add.text(this.game.world.centerX,this.game.world.centerY,"< Continue? >",RPG.textStyle),this.continueText.fontSize=28,this.continueText.x=this.game.world.centerX,this.continueText.y=this.game.world.centerY+20,this.continueText.anchor.setTo(.5),this.continueText.setShadow(0,0,"rgba(0,0,0,0.8)",10),this.continueText.inputEnabled=!0,this.continueText.input.useHandCursor=!0,this.continueText.events.onInputDown.add(this.continueGame,this))},continueGame:function(){RPG.continueData=JSON.parse(localStorage.getItem("data")),RPG.continueData.fbData.continue++;var t=RPG.firebase.database(),e=t.ref("/Data"),i=e.child(RPG.continueData.fbKey);i.update(RPG.continueData.fbData),RPG.PreloadState.playerData=RPG.continueData,RPG.continueData.continue=!0,RPG.eventQueue=[],RPG.PreloadState.tilemaps.forEach(function(t){var e=JSON.parse(localStorage.getItem(t));e=e.data,this.cache.getTilemapData(t).data=e},this),this.startGame()},startGame:function(){this.game.sound.play("start_game"),this.tween=this.game.add.tween(this.music).to({volume:0},1200,null).start(),this.game.camera.fade(0,1400),this.game.camera.onFadeComplete.add(function(){this.music.destroy(),this.state.start("Game")},this)},continueDataFalse:function(){var t=RPG.firebase.database();RPG.PreloadState.playerData.fbData.start=1;var e=t.ref("/Data").push(RPG.PreloadState.playerData.fbData);RPG.PreloadState.playerData.fbKey=e.key,RPG.continueData=RPG.PreloadState.playerData},newGame:function(){this.continueDataFalse(),this.startGame()},setSword:function(){var t=this;this.interval=8,this.sword.alpha=1,this.sword.anchor.setTo(.5),this.sword.scale.setTo(.6),this.flash(this.sword),this.text.setText("You've acquired the Holy Sword of Conservatism!"),Player.frame=9,this.cutSceneFired||(this.i=setTimeout(function(){Player.frame=11,t.sword.loadTexture("light"),t.sword.anchor.setTo(.5,0),t.sword.alpha=0,t.sword.x=t.game.world.centerX,t.sword.y=0,t.sword.scale.setTo(.35,0),t.swordTween=t.game.add.tween(t.sword.scale).to({y:.8,x:1},1800,"Quad.easeOut").start(),t.game.add.tween(t.sword).to({alpha:.8},1800,"Quad.easeOut").start(),t.harperSprite.frame=1,t.tween=t.game.add.tween(t.harperSprite).to({y:-60},3e3,null).start(),t.game.camera.fade(16777215,3e3),t.game.camera.onFadeComplete.add(function(){t.menuSetup()},t)},3e3))},flash:function(t){var e=this;e.game.sound.play("dialogue_next"),this.j=setTimeout(function(){var i=0===t.alpha?1:0;1===i&&e.game.sound.play("dialogue_next"),t.alpha=i,e.interval--,e.interval>0&&e.flash(t)},400)},setText:function(t,e,i){var a=e?e:this.game.height/3.9,s=i?this.game.width/2:60;this.text=this.textGroup.getFirstExists(!1),this.text?(this.text.reset(),this.text.y=a,this.text.x=s,i&&this.text.anchor.setTo(.5),this.text.setText(t)):(this.text=this.add.text(s,a,t,RPG.textStyle),this.text.lineSpacing=-5,this.text.wordWrap=!0,this.text.wordWrapWidth=this.game.width-60,this.textGroup.add(this.text)),this.text.alpha=0,this.cutSceneFired||(this.textTween=this.game.add.tween(this.text).to({alpha:1},800,"Quad.easeOut").start())},clearText:function(t){var e=t?t:800;this.textGroup.forEach(function(t){this.textTween=this.game.add.tween(t).to({alpha:0},e,null).start(),this.textTween.onComplete.add(function(){t.kill()},this)},this)}};